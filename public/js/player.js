// Generated by CoffeeScript 1.6.3
(function() {
  
// serializeJSON
(function(e){e.fn.serializeJSON=function(){var t={};jQuery.map(e(this).serializeArray(),function(e,n){t[e["name"]]=e["value"]});return t}})(jQuery)
;
  $(function() {
    var makeView, submitFields, tmplResults;
    $(".tags").tagsInput();
    $("select").selectpicker({
      style: 'btn-primary',
      menuStyle: 'dropdown-inverse'
    });
    $.getJSON('/api/templates', function(tmpls) {
      var tmpl, _i, _len, _results;
      _results = [];
      for (_i = 0, _len = tmpls.length; _i < _len; _i++) {
        tmpl = tmpls[_i];
        _results.push(ich.addTemplate(tmpl.name, tmpl.content));
      }
      return _results;
    });
    $('#filter-me').on('click', function(e) {
      e.preventDefault();
      return submitFields();
    });
    submitFields = function() {
      var fields;
      fields = $('.what-do-you-want').serializeJSON();
      return navigator.geolocation.getCurrentPosition(function(pos) {
        var location;
        location = {
          lat: pos.coords.latitude,
          lng: pos.coords.longitude
        };
        $.extend(fields, location);
        return $.get('/api/audiopts', fields, tmplResults);
      });
    };
    tmplResults = function(audiopts) {
      $('#point-listing').empty();
      return $(audiopts).each(function(i, el) {
        return $('#point-listing').append(ich.apListing(el));
      }).promise().done(makeView);
    };
    return makeView = function() {
      var inlinePlayer;
      inlinePlayer = null;
      return inlinePlayer = new InlinePlayer();
    };
  });

}).call(this);
